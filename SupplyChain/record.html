<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Records</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
	<link href="styles/css/app.css" rel="stylesheet">
	<script src="scripts/web3.js/web3.min.js"></script>
	<script src="scripts/jquery/jquery.min.js"></script>

</head>


<body>
	<div class="record">
		<h2 style="text-align: center;">Product History</h2>
	<a href="./index.html" class="btn btn-danger">Back to Home</a>
		<div class="content">
			<div class="form">
				<input id="itemid" type=text size=16 placeholder="Product ID" class=item-id><br><br>
				<button class="btn btn-success" onclick="History()">Submit</button>
			</div>

			<div class="record-list">
				<div class="container">
					<ol id="recordList" class="list-unstyled">
						<li>
							<h5>Product Start</h5>
						</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
	</div>
</body>
<script>
	// const obj = contract_instance;
	// console.log("instance", obj);
	// var ol = document.getElementById("recordList");
	// ol.innerHTML += "<li></li>"
</script>
	<script type="text/javascript">
      var contract_abi = [
        {

      "constant": true,
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_itemid",
				"type": "uint256"
			},
			{
				"name": "_vendor",
				"type": "address"
			},
			{
				"name": "_quotation",
				"type": "uint256"
			}
		],
		"name": "allotItemToVendor",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_to",
				"type": "address"
			}
		],
		"name": "destroySmartContract",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_itemid",
				"type": "uint256"
			}
		],
		"name": "getPresentStatus",
		"outputs": [
			{
				"name": "_holder",
				"type": "address"
			},
			{
				"name": "_timestampArrived",
				"type": "uint256"
			},
			{
				"name": "_timestampShipped",
				"type": "uint256"
			},
			{
				"name": "_nextStop",
				"type": "address"
			},
			{
				"name": "_vendor",
				"type": "address"
			},
			{
				"name": "_quotation",
				"type": "uint256"
			},
			{
				"name": "_status",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "listedholders",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "PresentConditionOfItem",
		"outputs": [
			{
				"name": "holder",
				"type": "address"
			},
			{
				"name": "timestampArrived",
				"type": "uint256"
			},
			{
				"name": "timestampShipped",
				"type": "uint256"
			},
			{
				"name": "nextStop",
				"type": "address"
			},
			{
				"name": "vendor",
				"type": "address"
			},
			{
				"name": "quotation",
				"type": "uint256"
			},
			{
				"name": "Status",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_itemid",
				"type": "uint256"
			}
		],
		"name": "updateStateOfArrivedItem",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_newholder",
				"type": "address"
			}
		],
		"name": "addHolder",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "History",
		"outputs": [
			{
				"name": "holder",
				"type": "address"
			},
			{
				"name": "timestampArrived",
				"type": "uint256"
			},
			{
				"name": "timestampShipped",
				"type": "uint256"
			},
			{
				"name": "nextStop",
				"type": "address"
			},
			{
				"name": "vendor",
				"type": "address"
			},
			{
				"name": "quotation",
				"type": "uint256"
			},
			{
				"name": "Status",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_itemid",
				"type": "uint256"
			}
		],
		"name": "getHistory",
		"outputs": [
			{
				"name": "",
				"type": "address[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "address[]"
			},
			{
				"name": "payble",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "listedItems",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_itemid",
				"type": "uint256"
			},
			{
				"name": "_nextStop",
				"type": "address"
			}
		],
		"name": "shipNext",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"payable": true,
		"stateMutability": "payable",
		"type": "fallback"
	}
    
];

      if (typeof web3 !== "undefined") {
        web3 = new Web3(web3.currentProvider);
      } 
      else {
        console.log("metamask fail");
      }

	  var contractAddress = '0x184eF0B83d3CFDa5a859839f4d27a2BF01049029';
	var contract = web3.eth.contract(contractAbi).at(contractAddress);
	console.log(contract);

		function History() {
			var _itemid = document.getElementById("itemid").value;
			console.log(_itemid);
			contract_instance.getHistory(_itemid, { from: web3.eth.accounts[0] }, function (error, result) {

				if (error) {
					console.error(error);
				}
				else {
					console.log(result[1][0]["c"][0]);
					console.log(result);
					console.log(result[1].length);
					for(var i=0;i<result[1].length;i++){
						document.getElementById("recordList").innerHTML += "<li><p style='font-size:0.8rem'><b>Address: "+result[0][i]+"</b></p><p>Timestamp Arrived: "+result[1][i]["c"][0]+"</p><p>Timestamp Shipped: "+result[2][i]["c"][0]+"</p></li>";
					}
					if(result[6]) {
						document.getElementById("recordList").innerHTML += "<li><h6><b>Not Delivered</b></h6></li>"
					} 
					else {
						document.getElementById("recordList").innerHTML += "<li><h6><b>Delivered</b></h6></li>"
					}
				}
			}

			)
		}

// 0: address[]: 0x4B0897b0513fdC7C541B6d9D7E929C4e5364D2dB,0x14723A09ACff6D2A60DcdF7aA4AFf308FDDC160C,0xCA35b7d915458EF540aDe6068dFe2F44E8fa733c
// 1: uint256[]: 1579199406,1579199483,1579199536
// 2: uint256[]: 1579199457,1579199520,0
// 3: address[]: 0x14723A09ACff6D2A60DcdF7aA4AFf308FDDC160C,0xCA35b7d915458EF540aDe6068dFe2F44E8fa733c,0x0000000000000000000000000000000000000000
// 4: address: payble 0x4B0897b0513fdC7C541B6d9D7E929C4e5364D2dB
// 5: uint256: 10
// 6: bool: false


	</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
	integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
	integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
	integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="scripts/custom/index.js"></script>
<script src="scripts/jquery/jquery.min.js"></script>

</html>